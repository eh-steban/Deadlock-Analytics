services:
  # Unified development container with Node.js, Python, and Rust
  devcontainer:
    build:
      context: ..
      dockerfile: Deadlock-Stats/.devcontainer/Dockerfile

    volumes:
      # Mount only this project
      - ../Deadlock-Stats:/workspaces/Deadlock-Stats:cached
      # Persist cargo cache for faster Rust builds
      - cargo-cache:/home/lifted/.cargo/registry
      - cargo-cache:/home/lifted/.cargo/git

    # Required for Rust debugger (ptrace-based)
    cap_add:
      - SYS_PTRACE
    security_opt:
      - seccomp:unconfined

    # Connect to other services (db, etc.) from root docker-compose.yaml
    depends_on:
      - dashjump-db

    # Environment variables for accessing other services
    environment:
      - DATABASE_URL=postgresql+psycopg://deadlock:deadlockpass@dashjump-db:5432/deadlock_db
      - PARSER_BASE_URL=http://dashjump-parser:9000
      - VITE_BACKEND_DOMAIN=localhost:8000

    # Keep container running
    command: sleep infinity

    # Enable interactive terminal
    stdin_open: true
    tty: true

volumes:
  cargo-cache:
